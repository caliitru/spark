<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Dashboard - Spark Studio</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#1337ec", "background-light": "#f6f6f8", "background-dark": "#101322" },
                    fontFamily: { "display": ["Inter", "sans-serif"] },
                },
            },
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 font-display">

<!-- Header -->
<header class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="size-10 bg-primary rounded-lg flex items-center justify-center text-white">
                <span class="material-symbols-outlined fill-1">bolt</span>
            </div>
            <h1 class="text-xl font-bold">Spark Studio</h1>
        </div>
        
        <nav class="flex items-center gap-1">
            <a href="dashboard.html" class="px-4 py-2 font-semibold text-primary border-b-2 border-primary">Dashboard</a>
            <a href="spark_studio_final4.html" class="px-4 py-2 font-medium text-slate-600 hover:text-slate-900">Campaigns</a>
            <a href="history.html" class="px-4 py-2 font-medium text-slate-600 hover:text-slate-900">History</a>
        </nav>
        
        <div class="flex items-center gap-3">
            <div class="size-9 rounded-full bg-primary text-white flex items-center justify-center font-bold text-sm">JD</div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-6 py-8">
    <div class="mb-8">
        <h2 class="text-3xl font-bold mb-2">Welcome back! ðŸ‘‹</h2>
        <p class="text-slate-600">Here's what's happening with your campaigns today.</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <span class="material-symbols-outlined text-primary text-3xl">campaign</span>
                <span class="text-xs font-semibold text-emerald-600 bg-emerald-50 px-2 py-1 rounded">+12%</span>
            </div>
            <h3 class="text-2xl font-bold mb-1" id="total-campaigns">0</h3>
            <p class="text-sm text-slate-600">Total Campaigns</p>
        </div>
        
        <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <span class="material-symbols-outlined text-purple-600 text-3xl">photo_camera</span>
                <span class="text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded">Active</span>
            </div>
            <h3 class="text-2xl font-bold mb-1" id="total-images">0</h3>
            <p class="text-sm text-slate-600">Images Generated</p>
        </div>
        
        <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <span class="material-symbols-outlined text-amber-600 text-3xl">description</span>
                <span class="text-xs font-semibold text-purple-600 bg-purple-50 px-2 py-1 rounded">New</span>
            </div>
            <h3 class="text-2xl font-bold mb-1" id="total-captions">0</h3>
            <p class="text-sm text-slate-600">Captions Created</p>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-gradient-to-r from-primary to-blue-600 rounded-xl p-8 mb-8 text-white">
        <h3 class="text-2xl font-bold mb-2">Ready to create something amazing?</h3>
        <p class="mb-6 text-blue-100">Generate AI-powered campaigns in seconds</p>
        <a href="spark_studio_final4.html" class="inline-flex items-center gap-2 bg-white text-primary px-6 py-3 rounded-lg font-bold hover:bg-blue-50 transition-colors">
            <span class="material-symbols-outlined">add_box</span>
            New Campaign
        </a>
    </div>

    <!-- Recent Campaigns -->
    <div class="bg-white rounded-xl border border-slate-200 shadow-sm">
        <div class="p-6 border-b border-slate-200">
            <h3 class="text-lg font-bold">Recent Campaigns</h3>
        </div>
        <div id="recent-campaigns" class="divide-y divide-slate-200">
            <!-- Campaigns will be loaded here -->
            <div class="p-6 text-center text-slate-500">
                <span class="material-symbols-outlined text-4xl mb-2 block text-slate-300">folder_open</span>
                <p>No campaigns yet. Create your first one!</p>
            </div>
        </div>
    </div>
</main>

<script>
// Load campaign stats from localStorage
document.addEventListener('DOMContentLoaded', () => {
    loadDashboardStats();
    loadRecentCampaigns();
});

function loadDashboardStats() {
    // Get all campaigns from localStorage
    const campaigns = getAllCampaigns();
    
    document.getElementById('total-campaigns').textContent = campaigns.length;
    
    // Count total images and captions
    let totalImages = 0;
    let totalCaptions = 0;
    
    campaigns.forEach(campaign => {
        if (campaign.result.images) totalImages += campaign.result.images.length;
        if (campaign.result.captions) totalCaptions += campaign.result.captions.length;
    });
    
    document.getElementById('total-images').textContent = totalImages;
    document.getElementById('total-captions').textContent = totalCaptions;
}

function loadRecentCampaigns() {
    const campaigns = getAllCampaigns().slice(0, 5); // Show last 5
    const container = document.getElementById('recent-campaigns');
    
    if (campaigns.length === 0) return;
    
    container.innerHTML = campaigns.map((campaign, index) => {
        const platform = campaign.input.platform || 'general';
        const company = campaign.input.company || 'Untitled';
        const timestamp = new Date(parseInt(campaign.timestamp)).toLocaleDateString();
        
        return `
            <div class="p-6 hover:bg-slate-50 transition-colors cursor-pointer" onclick="viewCampaign(${index})">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="size-12 bg-primary/10 rounded-lg flex items-center justify-center">
                            <span class="material-symbols-outlined text-primary">campaign</span>
                        </div>
                        <div>
                            <h4 class="font-semibold">${company}</h4>
                            <p class="text-sm text-slate-600">${platform.toUpperCase()} â€¢ ${timestamp}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-xs bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full font-semibold">
                            ${campaign.result.captions?.length || 0} Captions
                        </span>
                        <span class="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-semibold">
                            ${campaign.result.images?.length || 0} Images
                        </span>
                        <span class="material-symbols-outlined text-slate-400">chevron_right</span>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function getAllCampaigns() {
    const campaigns = [];
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('campaign_')) {
            try {
                campaigns.push(JSON.parse(localStorage.getItem(key)));
            } catch (e) {}
        }
    }
    return campaigns.sort((a, b) => b.timestamp - a.timestamp);
}

function viewCampaign(index) {
    const campaigns = getAllCampaigns();
    const campaign = campaigns[index];
    
    // Load campaign into storage
    localStorage.setItem('campaignResult', JSON.stringify(campaign.result));
    localStorage.setItem('campaignInput', JSON.stringify(campaign.input));
    
    // Navigate to output page
    window.location.href = 'spark_studio_output_FIXED4.html';
}
</script>

</body>
</html>